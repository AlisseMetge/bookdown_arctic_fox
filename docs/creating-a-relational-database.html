<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Creating a Relational Database | Arctic Fox Seasonal Molting</title>
  <meta name="description" content="<p>This is an attempt to use the bookdown package to write a book on the Arctic Fox Project.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Creating a Relational Database | Arctic Fox Seasonal Molting" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is an attempt to use the bookdown package to write a book on the Arctic Fox Project.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Creating a Relational Database | Arctic Fox Seasonal Molting" />
  
  <meta name="twitter:description" content="<p>This is an attempt to use the bookdown package to write a book on the Arctic Fox Project.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Alisse Metge" />


<meta name="date" content="2024-12-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="populating-the-database.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#overview-of-project"><i class="fa fa-check"></i><b>1.1</b> Overview of project</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#format-of-original-data"><i class="fa fa-check"></i><b>1.2</b> Format of original data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="creating-a-relational-database.html"><a href="creating-a-relational-database.html"><i class="fa fa-check"></i><b>2</b> Creating a Relational Database</a>
<ul>
<li class="chapter" data-level="2.1" data-path="creating-a-relational-database.html"><a href="creating-a-relational-database.html#structure-of-the-relational-database"><i class="fa fa-check"></i><b>2.1</b> Structure of the relational database</a></li>
<li class="chapter" data-level="2.2" data-path="creating-a-relational-database.html"><a href="creating-a-relational-database.html#creating-the-empty-database"><i class="fa fa-check"></i><b>2.2</b> Creating the empty database</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="populating-the-database.html"><a href="populating-the-database.html"><i class="fa fa-check"></i><b>3</b> Populating the database</a>
<ul>
<li class="chapter" data-level="3.1" data-path="populating-the-database.html"><a href="populating-the-database.html#sites-table"><i class="fa fa-check"></i><b>3.1</b> Sites table</a></li>
<li class="chapter" data-level="3.2" data-path="populating-the-database.html"><a href="populating-the-database.html#individuals-table"><i class="fa fa-check"></i><b>3.2</b> Individuals table</a></li>
<li class="chapter" data-level="3.3" data-path="populating-the-database.html"><a href="populating-the-database.html#site-year-conditions-table"><i class="fa fa-check"></i><b>3.3</b> Site-year conditions table</a></li>
<li class="chapter" data-level="3.4" data-path="populating-the-database.html"><a href="populating-the-database.html#molt-obeservations-table"><i class="fa fa-check"></i><b>3.4</b> Molt obeservations table</a></li>
<li class="chapter" data-level="3.5" data-path="populating-the-database.html"><a href="populating-the-database.html#check-the-data"><i class="fa fa-check"></i><b>3.5</b> Check the data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualizing-data-trends.html"><a href="visualizing-data-trends.html"><i class="fa fa-check"></i><b>4</b> Visualizing Data Trends</a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualizing-data-trends.html"><a href="visualizing-data-trends.html#general-molt-timing"><i class="fa fa-check"></i><b>4.1</b> General molt timing</a></li>
<li class="chapter" data-level="4.2" data-path="visualizing-data-trends.html"><a href="visualizing-data-trends.html#conditions-across-sites-and-years"><i class="fa fa-check"></i><b>4.2</b> Conditions across sites and years</a></li>
<li class="chapter" data-level="4.3" data-path="visualizing-data-trends.html"><a href="visualizing-data-trends.html#molt-timing-and-environmental-conditions"><i class="fa fa-check"></i><b>4.3</b> Molt timing and environmental conditions</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Arctic Fox Seasonal Molting</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="creating-a-relational-database" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Creating a Relational Database<a href="creating-a-relational-database.html#creating-a-relational-database" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="structure-of-the-relational-database" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Structure of the relational database<a href="creating-a-relational-database.html#structure-of-the-relational-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I created a relational database, as outlined in the following ERD:</p>
<p><img src="Documents/ArcticFoxERD.jpg" width="150%" style="display: block; margin: auto;" /></p>
<p>A parent table of sites assigns a short (3 characters) site ID to each site name (which are long Norwegian names with special characters). Another parent table lists each individual fox and its color morph (white or blue), which does not change. An intermediate table contains the environmental conditions at each site each year, and the final table contains all the molt observations of individual foxes. For these last two tables, the site_year_id and molt_id primary keys are autogenerated integers.</p>
</div>
<div id="creating-the-empty-database" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Creating the empty database<a href="creating-a-relational-database.html#creating-the-empty-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The relational database was constructed as follows. First, load the necessary R packages:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="creating-a-relational-database.html#cb1-1" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="creating-a-relational-database.html#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="creating-a-relational-database.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb1-4"><a href="creating-a-relational-database.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(RSQLite)</span></code></pre></div>
<p>Then, establish a database connection to create the database (note that this will be stored in whatever directory you are working in):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="creating-a-relational-database.html#cb2-1" tabindex="-1"></a><span class="co"># Create database</span></span>
<span id="cb2-2"><a href="creating-a-relational-database.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="creating-a-relational-database.html#cb2-3" tabindex="-1"></a>ArcticFox_db <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="st">&quot;ArcticFox_db.db&quot;</span>)</span></code></pre></div>
<p>Next, we can construct each table in the database using the RSQLite package. Here is the code to create the sites table, with columns for site id and the original site name:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="creating-a-relational-database.html#cb3-1" tabindex="-1"></a><span class="co"># Create sites table</span></span>
<span id="cb3-2"><a href="creating-a-relational-database.html#cb3-2" tabindex="-1"></a><span class="fu">dbExecute</span>(ArcticFox_db,</span>
<span id="cb3-3"><a href="creating-a-relational-database.html#cb3-3" tabindex="-1"></a>         <span class="st">&quot;CREATE TABLE sites (</span></span>
<span id="cb3-4"><a href="creating-a-relational-database.html#cb3-4" tabindex="-1"></a><span class="st">            site_id char(3) NOT NULL PRIMARY KEY,</span></span>
<span id="cb3-5"><a href="creating-a-relational-database.html#cb3-5" tabindex="-1"></a><span class="st">            site varchar(40)</span></span>
<span id="cb3-6"><a href="creating-a-relational-database.html#cb3-6" tabindex="-1"></a><span class="st">          );&quot;</span>)</span></code></pre></div>
<p>Code for the individuals table, which contains columns for individual ID and the morph (which does not change for each individual). Because there are only two possible entries for color morph, I constrained the characters using <code>CHECK</code> in the table.:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="creating-a-relational-database.html#cb4-1" tabindex="-1"></a><span class="co"># Create individuals table</span></span>
<span id="cb4-2"><a href="creating-a-relational-database.html#cb4-2" tabindex="-1"></a><span class="fu">dbExecute</span>(ArcticFox_db, </span>
<span id="cb4-3"><a href="creating-a-relational-database.html#cb4-3" tabindex="-1"></a>          <span class="st">&quot;CREATE TABLE individuals (</span></span>
<span id="cb4-4"><a href="creating-a-relational-database.html#cb4-4" tabindex="-1"></a><span class="st">indiv_ID varchar(12) NOT NULL PRIMARY KEY,</span></span>
<span id="cb4-5"><a href="creating-a-relational-database.html#cb4-5" tabindex="-1"></a><span class="st">morph char(1) CHECK (morph IN (&#39;W&#39;, &#39;B&#39;))</span></span>
<span id="cb4-6"><a href="creating-a-relational-database.html#cb4-6" tabindex="-1"></a><span class="st">);&quot;</span>)</span></code></pre></div>
<p>The site_year_conditions table will contain columns for the site id, year, and the environmental conditions (rodent index, temperature, snow depth, snow continuity). Note that because there are only four possible values for the rodent index, I constrained the values using <code>CHECK</code> in the table. It will also auto generate an integer for the site-year ID, which is the primary key:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="creating-a-relational-database.html#cb5-1" tabindex="-1"></a><span class="co"># Create site-year conditions table</span></span>
<span id="cb5-2"><a href="creating-a-relational-database.html#cb5-2" tabindex="-1"></a><span class="fu">dbExecute</span>(ArcticFox_db,</span>
<span id="cb5-3"><a href="creating-a-relational-database.html#cb5-3" tabindex="-1"></a>          <span class="st">&quot;CREATE TABLE site_year_conditions (</span></span>
<span id="cb5-4"><a href="creating-a-relational-database.html#cb5-4" tabindex="-1"></a><span class="st">site_year_id integer PRIMARY KEY AUTOINCREMENT,</span></span>
<span id="cb5-5"><a href="creating-a-relational-database.html#cb5-5" tabindex="-1"></a><span class="st">site_id char(3),</span></span>
<span id="cb5-6"><a href="creating-a-relational-database.html#cb5-6" tabindex="-1"></a><span class="st">year integer,</span></span>
<span id="cb5-7"><a href="creating-a-relational-database.html#cb5-7" tabindex="-1"></a><span class="st">rodent integer CHECK (rodent IN (&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;)),</span></span>
<span id="cb5-8"><a href="creating-a-relational-database.html#cb5-8" tabindex="-1"></a><span class="st">temperature real,</span></span>
<span id="cb5-9"><a href="creating-a-relational-database.html#cb5-9" tabindex="-1"></a><span class="st">snow_depth real,</span></span>
<span id="cb5-10"><a href="creating-a-relational-database.html#cb5-10" tabindex="-1"></a><span class="st">snow_continuous integer,</span></span>
<span id="cb5-11"><a href="creating-a-relational-database.html#cb5-11" tabindex="-1"></a><span class="st">FOREIGN KEY (site_id) REFERENCES sites(site_id)</span></span>
<span id="cb5-12"><a href="creating-a-relational-database.html#cb5-12" tabindex="-1"></a><span class="st">);&quot;</span>)</span></code></pre></div>
<p>And finally, the molt observation table, which contains columns for site-year ID, individual ID, the date, and the molt score. It will also generate an integer for the molt ID. Note that in the original data, date is recorded as the number of days since January 1, so I set it here to an integer. The molt score is the percentage of winter coat remaining (0, 5, 25, 50, 75, 95), so it will also be set as an integer. Here is the code:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="creating-a-relational-database.html#cb6-1" tabindex="-1"></a><span class="co"># Create molt observations table</span></span>
<span id="cb6-2"><a href="creating-a-relational-database.html#cb6-2" tabindex="-1"></a><span class="fu">dbExecute</span>(ArcticFox_db,</span>
<span id="cb6-3"><a href="creating-a-relational-database.html#cb6-3" tabindex="-1"></a>          <span class="st">&quot;CREATE TABLE molt_observations (</span></span>
<span id="cb6-4"><a href="creating-a-relational-database.html#cb6-4" tabindex="-1"></a><span class="st">molt_id integer PRIMARY KEY AUTOINCREMENT,</span></span>
<span id="cb6-5"><a href="creating-a-relational-database.html#cb6-5" tabindex="-1"></a><span class="st">site_year_id integer,</span></span>
<span id="cb6-6"><a href="creating-a-relational-database.html#cb6-6" tabindex="-1"></a><span class="st">indiv_ID varchar(12),</span></span>
<span id="cb6-7"><a href="creating-a-relational-database.html#cb6-7" tabindex="-1"></a><span class="st">date integer,</span></span>
<span id="cb6-8"><a href="creating-a-relational-database.html#cb6-8" tabindex="-1"></a><span class="st">moult_score integer,</span></span>
<span id="cb6-9"><a href="creating-a-relational-database.html#cb6-9" tabindex="-1"></a><span class="st">FOREIGN KEY (site_year_id) REFERENCES site_year_conditions(site_year_id),</span></span>
<span id="cb6-10"><a href="creating-a-relational-database.html#cb6-10" tabindex="-1"></a><span class="st">FOREIGN KEY (indiv_ID) REFERENCES individuals(indiv_ID)</span></span>
<span id="cb6-11"><a href="creating-a-relational-database.html#cb6-11" tabindex="-1"></a><span class="st">);&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="populating-the-database.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-DBcreation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
